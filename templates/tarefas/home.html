<!DOCTYPE html>
{% load static %}
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{% static 'tarefas/listar.css' %}">
  <title>Portal Not√≠cias VM</title>
</head>
<body>
  <div class="page">
    <div class="container">

      <!-- HEADER (linha inteira) -->
      <header class="header">
        <div class="logo">PORTAL NOT√çCIAS VM</div>

        <div class="search" role="search">
          <form action="{% url 'tarefas:home' %}" method="get" style="width:100%; display:flex; gap:8px; align-items:center;">
            <input type="search" name="q" placeholder="O que voc√™ procura?" aria-label="Buscar" />
            <button type="submit" style="border:0; background:transparent; font-weight:700; cursor:pointer;">üîé</button>
          </form>
        </div>
      </header>

      <!-- MAIN -->
      <main class="main">
        <!-- Hero / destaque -->
        <section class="hero" aria-labelledby="destaque-title">
          <h2 id="destaque-title">Destaque da obra / comunicado importante</h2>
          <p class="lead">Ex.: "Fechamento do m√™s ‚Äì Obras Regionais Norte" ou alertas de seguran√ßa.</p>
        </section>

        <h3 class="section-title">Novidades & Atualiza√ß√µes</h3>

        <!-- CONTE√öDO PRINCIPAL: duas colunas dentro do main (cards √† esquerda + timeline √† direita) -->
        <div style="display:flex; gap:20px; align-items:flex-start; margin-top:6px;">

          <!-- coluna esquerda: lista de not√≠cias -->
          <div style="flex:1;">
            <section class="news-grid" aria-live="polite">
              {% if noticias %}
                {% for noticia in noticias %}
                  <article class="news-card {% if forloop.first %}large{% else %}compact{% endif %}" role="article" style="margin-bottom:16px; padding:16px; background:#fff; border:1px solid #e8e8e8; border-radius:4px; position:relative;">
                    <div style="display:flex; justify-content:space-between; gap:12px;">
                      <div style="flex:1;">
                        <div style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
                          <span style="background:#fff6f6; color:#b93b3b; border:1px solid #f0d7d7; padding:5px 8px; border-radius:3px; font-size:13px;">{{ noticia.get_status_display|default:"Melhoria" }}</span>
                          <small style="color:#9aa0a3;">{{ noticia.publicado_em|date:"d/m/Y" }}</small>
                        </div>

                        <a class="title" href="{% url 'tarefas:noticia_detalhe' noticia.id %}" style="font-size:22px; font-weight:600; color:#222; text-decoration:none;">
                          {{ noticia.titulo }}
                        </a>

                        <div class="summary" style="color:#777; margin-top:8px; font-size:14px;">
                          {% if noticia.resumo %}
                            {{ noticia.resumo|truncatechars:140 }}
                          {% else %}
                            {{ noticia.conteudo|default:"Resumo breve n√£o dispon√≠vel."|truncatechars:140 }}
                          {% endif %}
                        </div>
                      </div>

                      <div style="width:110px; display:flex; flex-direction:column; align-items:flex-end; justify-content:center;">
                        <a href="{% url 'tarefas:noticia_detalhe' noticia.id %}" class="read-more" style="text-decoration:none; color:#b93b3b; border:1px solid #eee; padding:8px 10px; border-radius:3px;">
                          Ver mais ‚ñ∏
                        </a>
                      </div>
                    </div>

                    <div class="meta" style="margin-top:10px; display:flex; justify-content:space-between; color:#999; font-size:13px;">
                      <div>Por {{ noticia.autor|default:"Equipe VM" }}</div>
                      <div>
                        <a href="{% url 'tarefas:atualizar_noticia' noticia.id %}" style="color:#999; text-decoration:none; margin-right:8px;">Editar</a>
                        <a href="{% url 'tarefas:deletar_noticia' noticia.id %}" style="color:#999; text-decoration:none;">Deletar</a>
                      </div>
                    </div>
                  </article>
                {% endfor %}
              {% else %}
                <div class="news-card" style="padding:18px; background:#fff; border:1px solid #e8e8e8; border-radius:4px;">
                  <strong>Nenhuma not√≠cia cadastrada.</strong>
                  <p class="summary" style="color:#777;">Cadastre uma nova not√≠cia clicando em "Criar nova not√≠cia".</p>
                </div>
              {% endif %}
            </section>

            <!-- PAGINA√á√ÉO -->
            {% if is_paginated %}
            <div class="pagination" style="margin-top:14px; display:flex; gap:12px; align-items:center;">
              {% if page_obj.has_previous %}<a href="?page={{ page_obj.previous_page_number }}" class="pag" style="padding:8px 10px; border-radius:4px; border:1px solid #e6e6e6; text-decoration:none; color:#333;">Anterior</a>{% endif %}
              <span style="color:#666;">P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
              {% if page_obj.has_next %}<a href="?page={{ page_obj.next_page_number }}" class="pag" style="padding:8px 10px; border-radius:4px; border:1px solid #e6e6e6; text-decoration:none; color:#333;">Pr√≥xima</a>{% endif %}
            </div>
            {% endif %}

          </div>

          <!-- coluna direita: √∫ltimas atualiza√ß√µes (timeline) -->
          <aside style="width:340px;">
            <div style="background:#fff; border:1px solid #e8e8e8; padding:18px; border-radius:4px;">
              <h4 style="margin:0 0 6px 0; font-size:20px;">√öltimas atualiza√ß√µes</h4>
              <p class="muted" style="color:#9aa0a3; margin:0 0 12px 0;">Resumo r√°pido das entregas recentes.</p>

              <ul style="list-style:none; padding:0; margin:0;">
                {% for item in noticias|slice:":5" %}
                <li style="display:flex; gap:12px; align-items:flex-start; padding:10px 0; border-bottom:1px dashed #f0f0f0;">
                  <span style="width:12px; height:12px; border-radius:50%; background:#b93b3b; display:inline-block; margin-top:6px;"></span>
                  <div>
                    <strong style="display:block; font-size:15px; margin-bottom:6px;">{{ item.titulo|truncatechars:50 }}</strong>
                    <div style="color:#9aa0a3; font-size:13px;">Vers√£o 1.3.{{ forloop.counter }} <span style="float:right; color:#9aa0a3;">{{ item.publicado_em|date:'d/m/Y' }}</span></div>
                  </div>
                </li>
                {% empty %}
                <li>Nenhuma atualiza√ß√£o</li>
                {% endfor %}
              </ul>
            </div>
          </aside>

        </div> <!-- /colunas -->

        <!-- Links r√°pidos -->
        <div style="margin-top:18px;">
          <a href="{% url 'tarefas:criar_noticia' %}" style="font-weight:700; margin-right:12px;">+ Criar nova not√≠cia</a>
          <a href="{% url 'tarefas:home' %}">Voltar para home</a>
        </div>

      </main>

      <!-- rodap√© (ocupa as duas colunas quando existir) -->
      <footer class="site-footer" role="contentinfo" style="grid-column: 1 / -1;">
        ¬© {{ year|default:"2025" }} ‚Äî Portal Not√≠cias VM
      </footer>

    </div> <!-- /.container -->
  </div> <!-- /.page -->

  <!-- script simples para fazer os selects atualizarem a URL -->
  <script>
    document.getElementById('btn-filtrar')?.addEventListener('click', function(e){
      e.preventDefault();
      const tipo = document.getElementById('f-tipo').value;
      const versao = document.getElementById('f-versao').value;
      const periodo = document.getElementById('f-periodo').value;
      let url = new URL(window.location.href);
      if(tipo) url.searchParams.set('tipo', tipo); else url.searchParams.delete('tipo');
      if(versao) url.searchParams.set('versao', versao); else url.searchParams.delete('versao');
      if(periodo) url.searchParams.set('periodo', periodo); else url.searchParams.delete('periodo');
      window.location.href = url.toString();
    });
  </script>
</body>
</html>
